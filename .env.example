# =============================================================================
# Credit Scoring API - Environment Variables
# =============================================================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control!

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
APP_NAME=credit-scoring-api
APP_VERSION=1.0.0
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO

# -----------------------------------------------------------------------------
# API Configuration
# -----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=false

# CORS Settings (comma-separated list)
CORS_ORIGINS=http://localhost:3000,http://localhost:8501
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE
CORS_ALLOW_HEADERS=*

# -----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# -----------------------------------------------------------------------------
# PostgreSQL connection
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=credit_scoring_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=changeme_secure_password

# Database URL (auto-constructed from above, or set directly)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# SQLite fallback (for development)
SQLITE_DB_PATH=data/credit_scoring.db

# -----------------------------------------------------------------------------
# Authentication & Security
# -----------------------------------------------------------------------------
# JWT Secret Key (MUST be changed in production!)
# Generate with: openssl rand -hex 32
SECRET_KEY=your-secret-key-here-change-in-production-use-openssl-rand-hex-32

# JWT Algorithm
JWT_ALGORITHM=HS256

# Token expiration (in minutes)
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Password hashing
BCRYPT_ROUNDS=12

# -----------------------------------------------------------------------------
# Model Configuration
# -----------------------------------------------------------------------------
# MLflow tracking
MLFLOW_TRACKING_URI=file:///app/mlruns
MLFLOW_EXPERIMENT_NAME=credit_scoring_optimization

# Model paths
MODEL_PATH=models/best_model.pkl
SCALER_PATH=models/scaler.pkl
FEATURE_NAMES_PATH=models/feature_names.json

# Model registry
MODEL_NAME=credit_scoring_model
MODEL_STAGE=Production
MODEL_VERSION=latest

# -----------------------------------------------------------------------------
# Data Configuration
# -----------------------------------------------------------------------------
# Precomputed features
PRECOMPUTED_FEATURES_PATH=data/processed/precomputed_features.parquet

# Data directories
DATA_DIR=data
RAW_DATA_DIR=data/raw
PROCESSED_DATA_DIR=data/processed
UPLOAD_DIR=data/uploads

# File upload limits
MAX_UPLOAD_SIZE_MB=50
ALLOWED_EXTENSIONS=csv,parquet

# -----------------------------------------------------------------------------
# Feature Engineering
# -----------------------------------------------------------------------------
# Feature selection
N_FEATURES_TO_SELECT=189
FEATURE_SELECTION_METHOD=mutual_info_classif

# Polynomial features
POLY_DEGREE=2
POLY_INTERACTION_ONLY=true

# Domain aggregations
USE_DOMAIN_AGGREGATIONS=true
DOMAIN_AGG_METHODS=mean,median,max,min,std

# -----------------------------------------------------------------------------
# Preprocessing Configuration
# -----------------------------------------------------------------------------
# Missing value handling
MISSING_VALUE_THRESHOLD=0.9
MISSING_VALUE_STRATEGY=median

# Outlier detection
OUTLIER_METHOD=iqr
OUTLIER_THRESHOLD=3.0

# Scaling
SCALING_METHOD=standard
SCALE_FEATURES=true

# -----------------------------------------------------------------------------
# Prediction Settings
# -----------------------------------------------------------------------------
# Risk thresholds (probabilities)
RISK_THRESHOLD_LOW=0.30
RISK_THRESHOLD_MEDIUM=0.50
RISK_THRESHOLD_HIGH=0.70

# Default risk level for errors
DEFAULT_RISK_LEVEL=UNKNOWN

# Batch processing
BATCH_SIZE=1000
MAX_BATCH_APPLICATIONS=10000

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
# Log files
LOG_DIR=logs
PREDICTION_LOG_FILE=logs/predictions.jsonl
ERROR_LOG_FILE=logs/errors.log
ACCESS_LOG_FILE=logs/access.log

# Log rotation
LOG_MAX_BYTES=10485760
LOG_BACKUP_COUNT=5

# Structured logging format
LOG_FORMAT=json

# -----------------------------------------------------------------------------
# Monitoring & Observability
# -----------------------------------------------------------------------------
# Prometheus metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# Health check
HEALTH_CHECK_INTERVAL=30

# Data drift detection
ENABLE_DRIFT_DETECTION=true
DRIFT_DETECTION_THRESHOLD=0.05
DRIFT_REFERENCE_DATA_PATH=data/processed/X_train.csv

# Performance monitoring
ENABLE_PERFORMANCE_MONITORING=true
SLOW_REQUEST_THRESHOLD_MS=1000

# -----------------------------------------------------------------------------
# Streamlit Dashboard Configuration
# -----------------------------------------------------------------------------
STREAMLIT_HOST=0.0.0.0
STREAMLIT_PORT=8501
STREAMLIT_SERVER_HEADLESS=true
STREAMLIT_SERVER_ENABLE_CORS=false
STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=true

# API endpoint for Streamlit
API_BASE_URL=http://api:8000

# -----------------------------------------------------------------------------
# Docker Configuration
# -----------------------------------------------------------------------------
COMPOSE_PROJECT_NAME=credit-scoring
DOCKER_NETWORK=credit-scoring-network

# Container restart policy
RESTART_POLICY=unless-stopped

# Resource limits
API_MEMORY_LIMIT=2g
API_CPU_LIMIT=2
STREAMLIT_MEMORY_LIMIT=1g
STREAMLIT_CPU_LIMIT=1
POSTGRES_MEMORY_LIMIT=1g
POSTGRES_CPU_LIMIT=1

# -----------------------------------------------------------------------------
# Cache Configuration
# -----------------------------------------------------------------------------
# Redis (optional, for caching predictions)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# Cache TTL (in seconds)
CACHE_TTL=3600
ENABLE_CACHING=false

# -----------------------------------------------------------------------------
# Testing & Development
# -----------------------------------------------------------------------------
# Test database
TEST_DATABASE_URL=sqlite:///./test.db

# Test mode
TESTING=false

# Mock external services
MOCK_MLFLOW=false
MOCK_DATABASE=false

# -----------------------------------------------------------------------------
# Cloud Provider Settings (Optional)
# -----------------------------------------------------------------------------
# AWS S3 (for model/data storage)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
S3_BUCKET_NAME=

# Google Cloud Storage
GCS_PROJECT_ID=
GCS_BUCKET_NAME=
GOOGLE_APPLICATION_CREDENTIALS=

# Azure Blob Storage
AZURE_STORAGE_CONNECTION_STRING=
AZURE_CONTAINER_NAME=

# -----------------------------------------------------------------------------
# Email Notifications (Optional)
# -----------------------------------------------------------------------------
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@creditscore.com

# Alert recipients (comma-separated)
ALERT_EMAIL_RECIPIENTS=

# Enable email alerts
ENABLE_EMAIL_ALERTS=false

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_BATCH_PREDICTIONS=true
FEATURE_MODEL_INTERPRETATION=true
FEATURE_USER_MANAGEMENT=true
FEATURE_AUDIT_LOG=true
