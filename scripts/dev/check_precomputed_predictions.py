"""Check if precomputed predictions match training predictions."""
from pathlib import Path

import pandas as pd

PROJECT_ROOT = Path(__file__).parent.parent

# Load original training predictions
print("Loading train_predictions.csv (from apply_best_model.py)...")
train_preds = pd.read_csv(PROJECT_ROOT / 'results' / 'train_predictions.csv')

# Load SK_ID_CURR mapping
app_train = pd.read_csv(PROJECT_ROOT / 'data' / 'application_train.csv')
train_preds['SK_ID_CURR'] = app_train['SK_ID_CURR'].values

# Load precomputed predictions (just generated by precompute_features.py)
print("Loading precomputed_predictions.csv (from precompute_features.py)...")
precomp_preds = pd.read_csv(PROJECT_ROOT / 'data' / 'processed' / 'precomputed_predictions.csv')

print(f"\nOriginal predictions: {len(train_preds)} rows")
print(f"Precomputed predictions: {len(precomp_preds)} rows\n")

# Test with sample IDs
sample_ids = [100002, 100003, 100004]

print("="*80)
print("COMPARING PREDICTIONS")
print("="*80)

for sample_id in sample_ids:
    train_row = train_preds[train_preds['SK_ID_CURR'] == sample_id]
    precomp_row = precomp_preds[precomp_preds['SK_ID_CURR'] == sample_id]

    if len(train_row) == 0:
        print(f"ID {sample_id}: Not found in training predictions")
        continue

    if len(precomp_row) == 0:
        print(f"ID {sample_id}: Not found in precomputed predictions")
        continue

    train_prob = train_row['PROBABILITY'].values[0]
    precomp_prob = precomp_row['PROBABILITY'].values[0]
    diff = abs(train_prob - precomp_prob)

    match_str = "PERFECT MATCH!" if diff < 0.0001 else f"DIFF: {diff:.4f}"
    print(f"  ID {sample_id}: Training={train_prob:.6f}, Precomputed={precomp_prob:.6f} - {match_str}")

print("="*80)
